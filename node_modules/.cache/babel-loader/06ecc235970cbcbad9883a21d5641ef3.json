{"ast":null,"code":"var _jsxFileName = \"/home/danielmelchor/Documents/CodeProjects/Decentrapass/Website/src/pages/App/Login/Login.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport LogoNBG from \"../../../img/logo-nobg.png\";\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport { decrypt, hash } from \"../../../functions/encryption\";\nimport { formatData } from \"../../../functions/format\";\nimport { saveItems, changeItem, changePage, saveLogin } from \"../../../state/actions\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    saveItems: data => dispatch(saveItems(data)),\n    changeItem: item => dispatch(changeItem(item)),\n    changePage: page => dispatch(changePage(page)),\n    saveLogin: page => dispatch(saveLogin(page))\n  };\n};\n\nconst mapStateToProps = state => {\n  return {\n    contract: state.contract,\n    account: state.account,\n    password: state.password\n  };\n};\n\nexport class Login extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      pass: \"\",\n      wrongPass: false,\n      // Manages error message\n      redirect: null\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  async componentDidUpdate(prevProps, prevState) {\n    if (this.props.contract) {\n      let pass = await this.props.contract.methods.password(this.props.account).call();\n\n      if (!pass || pass === \"\") {\n        this.setState({\n          redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/app/register\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 35\n          }, this)\n        });\n      }\n\n      if (localStorage.localSession) {\n        let passLS = localStorage.localSession.split(\"-\")[0];\n        let time = new Date(localStorage.localSession.split(\"-\")[1]);\n        let now = new Date();\n        let diff = (now.getTime() - time.getTime()) / 3600 / 1000;\n\n        if (diff >= 1 || diff < 0 || passLS !== pass) {\n          localStorage.removeItem(\"localSession\");\n        } else {\n          let numItems = await this.props.contract.methods.numObjects(this.props.account).call();\n          let dataToSave = await formatData(numItems, this.props.contract.methods, this.props.account);\n          dataToSave = decrypt(dataToSave, pass);\n          this.props.saveItems(dataToSave);\n          this.props.changeItem(dataToSave[0]);\n          this.props.saveLogin(true);\n          this.setState({\n            redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/app/unlocked\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 81,\n              columnNumber: 37\n            }, this)\n          });\n        }\n      }\n    }\n  }\n\n  async handleSubmit(e) {\n    e.preventDefault();\n    let pass = hash(this.state.pass, this.props.account);\n    let numItems = await this.props.contract.methods.numObjects(this.props.account).call();\n    let dataToSave = await formatData(numItems, this.props.contract.methods, this.props.account);\n    dataToSave = decrypt(dataToSave, pass);\n\n    if (this.props.password === pass) {\n      this.props.saveItems(dataToSave);\n      this.props.changeItem(dataToSave[0]);\n      this.props.saveLogin(true);\n      this.setState({\n        redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/app/unlocked\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 33\n        }, this)\n      });\n      var current = new Date().toLocaleString();\n      localStorage.setItem(\"localSession\", pass + \"-\" + current);\n    } else {\n      this.props.saveLogin(false);\n      this.setState({\n        wrongPass: true\n      });\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [this.state.redirect, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col items-center justify-center w-full h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"flex form w-11/12 lg:w-1/2 h-16\",\n          onSubmit: this.handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"unlock-input\",\n            type: \"password\",\n            className: \"w-full border-2 border-solid dark:text-white bg-gray-300 border-gray-300 dark:bg-gray-700 dark:border-gray-700 text-xl lg:text-2xl px-5 py-3 focus:outline-none focus:border-blue-500 dark:focus:outline-none dark:focus:border-blue-500 rounded-l-xl\",\n            placeholder: \"Enter your master password\",\n            onChange: e => {\n              this.setState({\n                pass: e.target.value,\n                wrongPass: false\n              });\n            },\n            autoFocus: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"bg-green-500 border-green-500 py-3 px-4 rounded-r-xl focus:outline-none flex items-center justify-center h-full\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: LogoNBG,\n              className: \"h-full\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 11\n        }, this), this.state.wrongPass && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500 text-2xl mt-3\",\n          children: /*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Wrong master password!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n\n}\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Login));","map":{"version":3,"sources":["/home/danielmelchor/Documents/CodeProjects/Decentrapass/Website/src/pages/App/Login/Login.js"],"names":["React","Component","connect","LogoNBG","Redirect","withRouter","decrypt","hash","formatData","saveItems","changeItem","changePage","saveLogin","mapDispatchToProps","dispatch","data","item","page","mapStateToProps","state","contract","account","password","Login","constructor","props","pass","wrongPass","redirect","handleSubmit","bind","componentDidUpdate","prevProps","prevState","methods","call","setState","localStorage","localSession","passLS","split","time","Date","now","diff","getTime","removeItem","numItems","numObjects","dataToSave","e","preventDefault","current","toLocaleString","setItem","render","target","value"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport LogoNBG from \"../../../img/logo-nobg.png\";\n\nimport { Redirect, withRouter } from \"react-router-dom\";\n\nimport { decrypt, hash } from \"../../../functions/encryption\";\n\nimport { formatData } from \"../../../functions/format\";\nimport {\n  saveItems,\n  changeItem,\n  changePage,\n  saveLogin,\n} from \"../../../state/actions\";\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    saveItems: (data) => dispatch(saveItems(data)),\n    changeItem: (item) => dispatch(changeItem(item)),\n    changePage: (page) => dispatch(changePage(page)),\n    saveLogin: (page) => dispatch(saveLogin(page)),\n  };\n};\n\nconst mapStateToProps = (state) => {\n  return {\n    contract: state.contract,\n    account: state.account,\n    password: state.password,\n  };\n};\n\nexport class Login extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  state = {\n    pass: \"\",\n    wrongPass: false, // Manages error message\n    redirect: null,\n  };\n\n  async componentDidUpdate(prevProps, prevState) {\n    if (this.props.contract) {\n      let pass = await this.props.contract.methods\n        .password(this.props.account)\n        .call();\n\n      if (!pass || pass === \"\") {\n        this.setState({ redirect: <Redirect to=\"/app/register\" /> });\n      }\n\n      if (localStorage.localSession) {\n        let passLS = localStorage.localSession.split(\"-\")[0];\n        let time = new Date(localStorage.localSession.split(\"-\")[1]);\n        let now = new Date();\n\n        let diff = (now.getTime() - time.getTime()) / 3600 / 1000;\n        if (diff >= 1 || diff < 0 || passLS !== pass) {\n          localStorage.removeItem(\"localSession\");\n        } else {\n          let numItems = await this.props.contract.methods\n            .numObjects(this.props.account)\n            .call();\n\n          let dataToSave = await formatData(\n            numItems,\n            this.props.contract.methods,\n            this.props.account\n          );\n\n          dataToSave = decrypt(dataToSave, pass);\n          this.props.saveItems(dataToSave);\n          this.props.changeItem(dataToSave[0]);\n          this.props.saveLogin(true);\n          this.setState({ redirect: <Redirect to=\"/app/unlocked\" /> });\n        }\n      }\n    }\n  }\n\n  async handleSubmit(e) {\n    e.preventDefault();\n\n    let pass = hash(this.state.pass, this.props.account);\n\n    let numItems = await this.props.contract.methods\n      .numObjects(this.props.account)\n      .call();\n\n    let dataToSave = await formatData(\n      numItems,\n      this.props.contract.methods,\n      this.props.account\n    );\n\n    dataToSave = decrypt(dataToSave, pass);\n\n    if (this.props.password === pass) {\n      this.props.saveItems(dataToSave);\n      this.props.changeItem(dataToSave[0]);\n      this.props.saveLogin(true);\n      this.setState({ redirect: <Redirect to=\"/app/unlocked\" /> });\n\n      var current = new Date().toLocaleString();\n\n      localStorage.setItem(\"localSession\", pass + \"-\" + current);\n    } else {\n      this.props.saveLogin(false);\n      this.setState({ wrongPass: true });\n    }\n  }\n\n  render() {\n    return (\n      <>\n        {this.state.redirect}\n        <div className=\"flex flex-col items-center justify-center w-full h-full\">\n          <form\n            className=\"flex form w-11/12 lg:w-1/2 h-16\"\n            onSubmit={this.handleSubmit}\n          >\n            <input\n              id=\"unlock-input\"\n              type=\"password\"\n              className=\"w-full border-2 border-solid dark:text-white bg-gray-300 border-gray-300 dark:bg-gray-700 dark:border-gray-700 text-xl lg:text-2xl px-5 py-3 focus:outline-none focus:border-blue-500 dark:focus:outline-none dark:focus:border-blue-500 rounded-l-xl\"\n              placeholder=\"Enter your master password\"\n              onChange={(e) => {\n                this.setState({ pass: e.target.value, wrongPass: false });\n              }}\n              autoFocus\n            />\n            <button\n              type=\"submit\"\n              className=\"bg-green-500 border-green-500 py-3 px-4 rounded-r-xl focus:outline-none flex items-center justify-center h-full\"\n            >\n              <img src={LogoNBG} className=\"h-full\" />\n            </button>\n          </form>\n          {this.state.wrongPass && (\n            <div className=\"text-red-500 text-2xl mt-3\">\n              <h2>Wrong master password!</h2>\n            </div>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nexport default withRouter(connect(mapStateToProps, mapDispatchToProps)(Login));\n"]},"metadata":{},"sourceType":"module"}