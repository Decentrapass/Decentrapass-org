{"ast":null,"code":"var _jsxFileName = \"/home/danielmelchor/Documents/CodeProjects/Decentrapass/Website/src/pages/App/AddItem/AddItem.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport AddDataField from \"./DataCreate/AddDataField\";\nimport { IF } from \"../../../components/Constants/AddInterfaces\";\nimport { encrypt } from \"../../../functions/encryption\";\nimport { changeItem, changePage, saveItems, saveTx } from \"../../../state/actions\";\nimport { TYPES_INT } from \"../../../components/Constants/constants\";\nimport { formatItem, formatSend } from \"../../../functions/format\";\nimport { Redirect } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst {\n  create\n} = require(\"ipfs-http-client\");\n\nconst ipfs = create({\n  host: \"ipfs.infura.io\",\n  port: 5001,\n  protocol: \"https\"\n});\n\nconst mapStateToProps = state => {\n  return {\n    addingItem: state.addingItem,\n    account: state.account,\n    contract: state.contract,\n    items: state.items,\n    password: state.password\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    changePage: page => dispatch(changePage(page)),\n    changeItem: item => dispatch(changeItem(item)),\n    saveItems: data => dispatch(saveItems(data)),\n    saveTx: data => dispatch(saveTx(data))\n  };\n};\n\nclass AddItem extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      redirect: null\n    };\n    this.stateChanger = this.stateChanger.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  stateChanger(name, val) {\n    this.setState({\n      [name]: val\n    }); // Saves input values on state\n  }\n\n  componentDidMount() {\n    if (this.props.addingItem === null) {\n      this.setState({\n        redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/app/unlocked\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 33\n        }, this)\n      });\n    }\n  }\n\n  async handleSubmit() {\n    let type = TYPES_INT[this.props.addingItem];\n    let data = [];\n\n    for (const i of Object.keys(IF[this.props.addingItem])) {\n      data.push(this.state[i] || \"\"); // If null set to empty string (avoid errors)\n    }\n\n    let nextId = await this.props.contract.methods.numObjects(this.props.account).call();\n    let newItem = formatItem(type, data, this.props.items.length, nextId);\n    this.props.saveItems(this.props.items.concat([newItem]));\n    this.props.changeItem(newItem);\n    let toSend = await formatSend(encrypt(data, this.props.password));\n    let res = await ipfs.add(toSend);\n    this.props.contract.methods.saveObject(type, nextId, res.path).send({\n      from: this.props.account\n    }).on(\"transactionHash\", function (hash) {\n      this.props.saveTx(hash);\n    }.bind(this));\n    this.setState({\n      redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/app/unlocked\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 31\n      }, this)\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [this.state.redirect, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col relative bg-green-50 dark:bg-gray-900 w-full h-full justify-end items-center pb-24\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col justify-start items-center cursor-pointer w-2/3 h-5/6\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"overflow-y-auto w-full mb-10 border border-solid border-gray-400 dark:border-gray-200 p-8 rounded-xl\",\n            children: this.props.addingItem && Object.keys(IF[this.props.addingItem]).map((el, key) => {\n              return /*#__PURE__*/_jsxDEV(AddDataField, {\n                fieldLabel: el,\n                fieldName: IF[this.props.addingItem][el][0],\n                fieldType: IF[this.props.addingItem][el][1],\n                elementType: this.props.addingItem,\n                stateChanger: this.stateChanger\n              }, key, false, {\n                fileName: _jsxFileName,\n                lineNumber: 107,\n                columnNumber: 21\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between w-full\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"w-48 py-2 bg-red-300 border-2 border-red-500 dark:border-red-600 dark:bg-red-800 hover:bg-red-500 dark:hover:bg-red-600 text-xl text-white\",\n              onClick: () => this.setState({\n                redirect: /*#__PURE__*/_jsxDEV(Redirect, {\n                  to: \"/app/unlocked\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 123,\n                  columnNumber: 31\n                }, this)\n              }),\n              children: \"Cancel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"w-48 py-2 bg-green-300 border-2 border-green-500 dark:border-green-600 dark:bg-green-800 hover:bg-green-500 dark:hover:bg-green-600 text-xl text-white\",\n              onClick: this.handleSubmit,\n              children: \"Add\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddItem);","map":{"version":3,"sources":["/home/danielmelchor/Documents/CodeProjects/Decentrapass/Website/src/pages/App/AddItem/AddItem.js"],"names":["React","Component","connect","AddDataField","IF","encrypt","changeItem","changePage","saveItems","saveTx","TYPES_INT","formatItem","formatSend","Redirect","create","require","ipfs","host","port","protocol","mapStateToProps","state","addingItem","account","contract","items","password","mapDispatchToProps","dispatch","page","item","data","AddItem","constructor","props","redirect","stateChanger","bind","handleSubmit","name","val","setState","componentDidMount","type","i","Object","keys","push","nextId","methods","numObjects","call","newItem","length","concat","toSend","res","add","saveObject","path","send","from","on","hash","render","map","el","key"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport AddDataField from \"./DataCreate/AddDataField\";\nimport { IF } from \"../../../components/Constants/AddInterfaces\";\nimport { encrypt } from \"../../../functions/encryption\";\nimport {\n  changeItem,\n  changePage,\n  saveItems,\n  saveTx,\n} from \"../../../state/actions\";\nimport { TYPES_INT } from \"../../../components/Constants/constants\";\nimport { formatItem, formatSend } from \"../../../functions/format\";\nimport { Redirect } from \"react-router-dom\";\n\nconst { create } = require(\"ipfs-http-client\");\nconst ipfs = create({\n  host: \"ipfs.infura.io\",\n  port: 5001,\n  protocol: \"https\",\n});\n\nconst mapStateToProps = (state) => {\n  return {\n    addingItem: state.addingItem,\n    account: state.account,\n    contract: state.contract,\n    items: state.items,\n    password: state.password,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    changePage: (page) => dispatch(changePage(page)),\n    changeItem: (item) => dispatch(changeItem(item)),\n    saveItems: (data) => dispatch(saveItems(data)),\n    saveTx: (data) => dispatch(saveTx(data)),\n  };\n};\n\nclass AddItem extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      redirect: null,\n    };\n\n    this.stateChanger = this.stateChanger.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  stateChanger(name, val) {\n    this.setState({ [name]: val }); // Saves input values on state\n  }\n\n  componentDidMount() {\n    if (this.props.addingItem === null) {\n      this.setState({ redirect: <Redirect to=\"/app/unlocked\" /> });\n    }\n  }\n\n  async handleSubmit() {\n    let type = TYPES_INT[this.props.addingItem];\n    let data = [];\n\n    for (const i of Object.keys(IF[this.props.addingItem])) {\n      data.push(this.state[i] || \"\"); // If null set to empty string (avoid errors)\n    }\n\n    let nextId = await this.props.contract.methods\n      .numObjects(this.props.account)\n      .call();\n    let newItem = formatItem(type, data, this.props.items.length, nextId);\n\n    this.props.saveItems(this.props.items.concat([newItem]));\n    this.props.changeItem(newItem);\n\n    let toSend = await formatSend(encrypt(data, this.props.password));\n\n    let res = await ipfs.add(toSend);\n\n    this.props.contract.methods\n      .saveObject(type, nextId, res.path)\n      .send({ from: this.props.account })\n      .on(\n        \"transactionHash\",\n        function (hash) {\n          this.props.saveTx(hash);\n        }.bind(this)\n      );\n\n    this.setState({ redirect: <Redirect to=\"/app/unlocked\" /> });\n  }\n\n  render() {\n    return (\n      <>\n        {this.state.redirect}\n        <div className=\"flex flex-col relative bg-green-50 dark:bg-gray-900 w-full h-full justify-end items-center pb-24\">\n          <div className=\"flex flex-col justify-start items-center cursor-pointer w-2/3 h-5/6\">\n            <div className=\"overflow-y-auto w-full mb-10 border border-solid border-gray-400 dark:border-gray-200 p-8 rounded-xl\">\n              {this.props.addingItem &&\n                Object.keys(IF[this.props.addingItem]).map((el, key) => {\n                  return (\n                    <AddDataField\n                      key={key}\n                      fieldLabel={el}\n                      fieldName={IF[this.props.addingItem][el][0]}\n                      fieldType={IF[this.props.addingItem][el][1]}\n                      elementType={this.props.addingItem}\n                      stateChanger={this.stateChanger}\n                    />\n                  );\n                })}\n            </div>\n            <div className=\"flex justify-between w-full\">\n              <button\n                className=\"w-48 py-2 bg-red-300 border-2 border-red-500 dark:border-red-600 dark:bg-red-800 hover:bg-red-500 dark:hover:bg-red-600 text-xl text-white\"\n                onClick={() =>\n                  this.setState({\n                    redirect: <Redirect to=\"/app/unlocked\" />,\n                  })\n                }\n              >\n                Cancel\n              </button>\n              <button\n                className=\"w-48 py-2 bg-green-300 border-2 border-green-500 dark:border-green-600 dark:bg-green-800 hover:bg-green-500 dark:hover:bg-green-600 text-xl text-white\"\n                onClick={this.handleSubmit}\n              >\n                Add\n              </button>\n            </div>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AddItem);\n"]},"metadata":{},"sourceType":"module"}